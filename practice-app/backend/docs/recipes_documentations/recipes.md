# üìò Recipe API Documentation

This document describes how to use the Recipe API endpoint, which allows for creating new recipes and retrieving detailed recipe information, including associated ingredients.

## üìç Endpoints
### 1. **POST** `/recipes/`
- Creates a new recipe with the provided data.
- Requires the user to be authenticated (via Bearer token).
- The creator field is automatically assigned based on the logged-in user via Bearer token (JWT).

#### üîç Request Format
```json
{
  "name": "Veggie Omelette",
  "steps": [
    "Crack the eggs into a bowl and whisk them",
    "Chop the vegetables finely",
  ],
  "prep_time": 3,
  "cook_time": 5,
  "meal_type": "lunch",
  "ingredients": [
    {
      "ingredient_name": "Eggs",
      "quantity": 3,
      "unit": "pcs"
    },
    {
      "ingredient_name": "Bell Pepper",
      "quantity": 1,
      "unit": "pcs"
    },
    {
      "ingredient_name": "Olive Oil",
      "quantity": 1,
      "unit": "tbsp"
    }
  ],
  "image": "<any image file in png or jpg format>"
}
```

- Optional:
  - `image`: An image file in png or jpg format to be uploaded to Cloudinary and associated with the recipe.

- Must be provided:
  - `name`: The name of the recipe.
  - `steps`: The steps to prepare the recipe. (Rememinder: The steps should be in a list format, not a string. And can be empty string if the user not sure about the steps for now.)
  - `prep_time`: Preparation time in minutes.
  - `cook_time`: Cooking time in minutes.
  - `meal_type`: Type of meal (e.g., breakfast, lunch, dinner).
  - `ingredients`: List of ingredients with their names, quantities, and units.
- **Note**: The `ingredients` field should contain a list of objects, each with `ingredient_name`, `quantity`, and `unit`.
- The `creator` field is automatically set based on the authenticated user.
- The `id` field is automatically generated by the database.
- The `created_at`, `updated_at`, and `deleted_on` fields are managed by the database.
- The `deleted_on` field is set to `null` when the recipe is created.

#### üì¶ Response Format
```json
{
  "id": 59,
  "name": "Veggie Omlette",
  "steps": [
    "Crack the eggs into a bowl and whisk them,Chop the vegetables finely"
  ],
  "prep_time": 3,
  "cook_time": 5,
  "meal_type": "lunch",
  "creator_id": 1,
  "ingredients": [
    {
      "ingredient": {
        "id": 225,
        "created_at": "2025-10-16T21:02:31Z",
        "updated_at": "2025-10-16T21:02:31Z",
        "deleted_on": null,
        "name": "Eggs",
        "category": "proteins",
        "allergens": [
          "egg"
        ],
        "dietary_info": [
          "high-protein",
          "gluten-free"
        ],
        "base_unit": "pcs",
        "base_quantity": "1.00",
        "allowed_units": [
          "pcs"
        ],
        "prices": {
          "currency": "USD",
          "A101": 0.2,
          "SOK": 0.23,
          "BIM": 0.23,
          "MIGROS": 0.26
        }
      },
      "quantity": "3.00",
      "unit": "pcs",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 0.6,
        "SOK": 0.69,
        "BIM": 0.69,
        "MIGROS": 0.78
      }
    },
    {
      "ingredient": {
        "id": 212,
        "created_at": "2025-10-16T21:02:31Z",
        "updated_at": "2025-10-16T21:02:31Z",
        "deleted_on": null,
        "name": "Bell Pepper",
        "category": "vegetables",
        "allergens": [],
        "dietary_info": [
          "vegan",
          "gluten-free"
        ],
        "base_unit": "pcs",
        "base_quantity": "1.00",
        "allowed_units": [
          "pcs"
        ],
        "prices": {
          "currency": "USD",
          "A101": 0.75,
          "SOK": 0.7,
          "BIM": 0.65,
          "MIGROS": 0.8
        }
      },
      "quantity": "1.00",
      "unit": "pcs",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 0.75,
        "SOK": 0.7,
        "BIM": 0.65,
        "MIGROS": 0.8
      }
    },
    {
      "ingredient": {
        "id": 233,
        "created_at": "2025-10-16T21:02:31Z",
        "updated_at": "2025-10-16T21:02:31Z",
        "deleted_on": null,
        "name": "Olive Oil",
        "category": "oils_and_fats",
        "allergens": [],
        "dietary_info": [
          "healthy-fat"
        ],
        "base_unit": "ml",
        "base_quantity": "100.00",
        "allowed_units": [
          "ml",
          "l",
          "tbsp"
        ],
        "prices": {
          "currency": "USD",
          "A101": 1.2,
          "SOK": 1.35,
          "BIM": 1.1,
          "MIGROS": 1.25
        }
      },
      "quantity": "1.00",
      "unit": "tbsp",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 0.3,
        "SOK": 0.34,
        "BIM": 0.28,
        "MIGROS": 0.31
      }
    }
  ],
  "cost_per_serving": "1.62",
  "recipe_costs": {
    "A101": 1.65,
    "SOK": 1.73,
    "BIM": 1.62,
    "MIGROS": 1.89
  },
  "difficulty_rating": null,
  "taste_rating": null,
  "health_rating": null,
  "like_count": 0,
  "comment_count": 0,
  "difficulty_rating_count": 0,
  "taste_rating_count": 0,
  "health_rating_count": 0,
  "is_approved": false,
  "is_featured": false,
  "created_at": "2025-10-18T09:52:56.727695Z",
  "updated_at": "2025-10-18T09:52:56.727727Z",
  "deleted_on": null,
  "total_time": 8,
  "total_user_ratings": 0,
  "total_ratings": 0,
  "allergens": [
    "egg"
  ],
  "dietary_info": [
    "healthy-fat",
    "high-protein",
    "gluten-free",
    "vegan"
  ],
  "image": "image/upload/v1760781176/yepwgq9gxqvkjl4eakev.jpg",
  "image_relative_url": "yepwgq9gxqvkjl4eakev",
  "image_full_url": "http://res.cloudinary.com/damwfwbjd/image/upload/v1760781176/yepwgq9gxqvkjl4eakev.jpg"
}
```

### 2. **GET** `/recipes/`
- Retrieves a list of all recipes.
- Supports pagination with `page` and `page_size` query parameters.
- The response includes the total number of recipes and the current page of results.
- Useful for displaying a list of recipes in a UI.

#### üîç Request Format
```json
{
  "page": 7,
  "page_size": 3
}
```

- Optional:
  - `page`: The page number to retrieve (default is 1).
  - `page_size`: The number of items to return per page (default is 10).
  - **Note:** The `page` and `page_size` parameters are written to code easier, we will never use these parameters in the frontend. You can get the wanted id with only giving the name field.

#### üì¶ Response Format
```json
{
  "page": 7,
  "page_size": 3,
  "total": 22,
  "results": [
    {
      "id": 58,
      "name": "Omlette",
      "meal_type": "lunch",
      "creator_id": 1,
      "prep_time": 3,
      "cook_time": 5,
      "recipe_costs": {
        "A101": 1.65,
        "SOK": 1.73,
        "BIM": 1.62,
        "MIGROS": 1.89
      },
      "cost_per_serving": "1.62",
      "difficulty_rating": null,
      "difficulty_rating_count": 0,
      "taste_rating": null,
      "taste_rating_count": 0,
      "health_rating": null,
      "health_rating_count": 0,
      "like_count": 0,
      "comment_count": 0,
      "is_approved": false,
      "is_featured": false,
      "total_time": 8,
      "image": "image/upload/v1760780815/c6lexq9mkrillls9r4zw.png",
      "image_relative_url": "c6lexq9mkrillls9r4zw",
      "image_full_url": "http://res.cloudinary.com/damwfwbjd/image/upload/v1760780815/c6lexq9mkrillls9r4zw.png"
    },
    {
      "id": 59,
      "name": "Veggie Omlette",
      "meal_type": "lunch",
      "creator_id": 1,
      "prep_time": 3,
      "cook_time": 5,
      "recipe_costs": {
        "A101": 1.65,
        "SOK": 1.73,
        "BIM": 1.62,
        "MIGROS": 1.89
      },
      "cost_per_serving": "1.62",
      "difficulty_rating": null,
      "difficulty_rating_count": 0,
      "taste_rating": null,
      "taste_rating_count": 0,
      "health_rating": null,
      "health_rating_count": 0,
      "like_count": 0,
      "comment_count": 0,
      "is_approved": false,
      "is_featured": false,
      "total_time": 8,
      "image": "image/upload/v1760781176/yepwgq9gxqvkjl4eakev.jpg",
      "image_relative_url": "yepwgq9gxqvkjl4eakev",
      "image_full_url": "http://res.cloudinary.com/damwfwbjd/image/upload/v1760781176/yepwgq9gxqvkjl4eakev.jpg"
    },
    {
      "id": 64,
      "name": "Avocado Toast",
      "meal_type": "breakfast",
      "creator_id": 1,
      "prep_time": 5,
      "cook_time": 5,
      "recipe_costs": {
        "A101": 3.66,
        "SOK": 3.52,
        "BIM": 3.86,
        "MIGROS": 3.51
      },
      "cost_per_serving": "3.51",
      "difficulty_rating": null,
      "difficulty_rating_count": 0,
      "taste_rating": null,
      "taste_rating_count": 0,
      "health_rating": null,
      "health_rating_count": 0,
      "like_count": 0,
      "comment_count": 0,
      "is_approved": false,
      "is_featured": false,
      "total_time": 10,
      "image": "image/upload/v1760781582/ackafdvoi7mdd4venbxb.jpg",
      "image_relative_url": "ackafdvoi7mdd4venbxb",
      "image_full_url": "http://res.cloudinary.com/damwfwbjd/image/upload/v1760781582/ackafdvoi7mdd4venbxb.jpg"
    }
  ]
}
```

### 3. **GET** `/recipes/{recipe_id}/`
- Retrieves detailed information about a specific recipe by its ID.
- The response includes the recipe's name, steps, preparation and cooking times, meal type, creator ID, and a list of associated ingredients.
- Useful for displaying detailed recipe information in a UI.

#### üîç Request Format
- Path variable:
  - "id": 64

- Must be provided:
  - `id`: The ID of the recipe to retrieve.


#### üì¶ Response Format
```json
{
  "id": 64,
  "name": "Avocado Toast",
  "steps": [
    "Toast the bread slices until golden brown,Mash the avocado and spread it on the toast"
  ],
  "prep_time": 5,
  "cook_time": 5,
  "meal_type": "breakfast",
  "creator_id": 1,
  "ingredients": [
    {
      "ingredient": {
        "id": 293,
        "created_at": "2025-10-18T12:59:15Z",
        "updated_at": "2025-10-18T12:59:15Z",
        "deleted_on": null,
        "name": "Bread",
        "category": "bakery",
        "allergens": [],
        "dietary_info": [
          "vegan",
          "gluten-free"
        ],
        "base_unit": "pcs",
        "base_quantity": "1.00",
        "allowed_units": [
          "pcs"
        ],
        "prices": {
          "currency": "USD",
          "A101": 1.2,
          "SOK": 1.15,
          "BIM": 1.25,
          "MIGROS": 1.1
        }
      },
      "quantity": "2.00",
      "unit": "pcs",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 2.4,
        "SOK": 2.3,
        "BIM": 2.5,
        "MIGROS": 2.2
      }
    },
    {
      "ingredient": {
        "id": 246,
        "created_at": "2025-10-16T21:02:59Z",
        "updated_at": "2025-10-16T21:02:59Z",
        "deleted_on": null,
        "name": "Avocado",
        "category": "fruits",
        "allergens": [],
        "dietary_info": [
          "vegan",
          "healthy-fat"
        ],
        "base_unit": "pcs",
        "base_quantity": "1.00",
        "allowed_units": [
          "pcs"
        ],
        "prices": {
          "currency": "USD",
          "A101": 1.2,
          "SOK": 1.15,
          "BIM": 1.3,
          "MIGROS": 1.25
        }
      },
      "quantity": "1.00",
      "unit": "pcs",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 1.2,
        "SOK": 1.15,
        "BIM": 1.3,
        "MIGROS": 1.25
      }
    },
    {
      "ingredient": {
        "id": 233,
        "created_at": "2025-10-16T21:02:31Z",
        "updated_at": "2025-10-16T21:02:31Z",
        "deleted_on": null,
        "name": "Olive Oil",
        "category": "oils_and_fats",
        "allergens": [],
        "dietary_info": [
          "healthy-fat"
        ],
        "base_unit": "ml",
        "base_quantity": "100.00",
        "allowed_units": [
          "ml",
          "l",
          "tbsp"
        ],
        "prices": {
          "currency": "USD",
          "A101": 1.2,
          "SOK": 1.35,
          "BIM": 1.1,
          "MIGROS": 1.25
        }
      },
      "quantity": "1.00",
      "unit": "tsp",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 0.06,
        "SOK": 0.07,
        "BIM": 0.06,
        "MIGROS": 0.06
      }
    }
  ],
  "cost_per_serving": "3.51",
  "recipe_costs": {
    "A101": 3.66,
    "SOK": 3.52,
    "BIM": 3.86,
    "MIGROS": 3.51
  },
  "difficulty_rating": null,
  "taste_rating": null,
  "health_rating": null,
  "like_count": 0,
  "comment_count": 0,
  "difficulty_rating_count": 0,
  "taste_rating_count": 0,
  "health_rating_count": 0,
  "is_approved": false,
  "is_featured": false,
  "created_at": "2025-10-18T09:59:42.482660Z",
  "updated_at": "2025-10-18T09:59:42.482697Z",
  "deleted_on": null,
  "total_time": 10,
  "total_user_ratings": 0,
  "total_ratings": 0,
  "allergens": [],
  "dietary_info": [
    "gluten-free",
    "vegan",
    "healthy-fat"
  ],
  "image": "image/upload/v1760781582/ackafdvoi7mdd4venbxb.jpg",
  "image_relative_url": "ackafdvoi7mdd4venbxb",
  "image_full_url": "http://res.cloudinary.com/damwfwbjd/image/upload/v1760781582/ackafdvoi7mdd4venbxb.jpg"
}
```

### 4. **PUT** `/recipes/{recipe_id}/`
- Updates an existing recipe with the provided data.
- Requires the user to be authenticated (via Bearer token).
- The creator field is automatically assigned based on the logged-in user via Bearer token (JWT).

#### üîç Request Format
- Data:
```json
{
  "name": "Updated Omelette",
  "steps": [
    "Crack the eggs into a bowl and whisk them.",
    "Chop the vegetables finely."
  ],
  "prep_time": 5,
  "cook_time": 5,
  "meal_type": "lunch",
  "ingredients": [
    {
      "ingredient_name": "Eggs",
      "quantity": 2,
      "unit": "pcs"
    },
    {
      "ingredient_name": "Bell Pepper",
      "quantity": 4,
      "unit": "pcs"
    }
  ],
  "image": "<any image file in png or jpg format>"
}
```

- Path variable:
  - "id": 52

- Must be provided:
  - `id`: The ID of the recipe to retrieve.

- Optional:
  - `name`: The name of the recipe.
  - `steps`: The steps to prepare the recipe. (Reminder: The steps should be in a list format, not a string. And can be empty string if the user not sure about the steps for now.)
  - `prep_time`: Preparation time in minutes.
  - `cook_time`: Cooking time in minutes.
  - `meal_type`: Type of meal (e.g., breakfast, lunch, dinner).
  - `ingredients`: List of ingredients with their names, quantities, and units.
  - `image`: An image file in png or jpg format to be uploaded to Cloudinary and associated with the recipe.
- **Note**: The `ingredients` field should contain a list of objects, each with `ingredient_name`, `quantity`, and `unit`.
- The `creator` field is automatically set based on the authenticated user.
- The `created_at`, `updated_at`, and `deleted_on` fields are managed by the database.

#### üì¶ Response Format
```json
{
  "id": 52,
  "name": "Updated Omelette",
  "steps": [
    "Crack the eggs into a bowl and whisk them.,Chop the vegetables finely."
  ],
  "prep_time": 5,
  "cook_time": 5,
  "meal_type": "lunch",
  "creator_id": 1,
  "ingredients": [
    {
      "ingredient": {
        "id": 225,
        "created_at": "2025-10-16T21:02:31Z",
        "updated_at": "2025-10-16T21:02:31Z",
        "deleted_on": null,
        "name": "Eggs",
        "category": "proteins",
        "allergens": [
          "egg"
        ],
        "dietary_info": [
          "high-protein",
          "gluten-free"
        ],
        "base_unit": "pcs",
        "base_quantity": "1.00",
        "allowed_units": [
          "pcs"
        ],
        "prices": {
          "currency": "USD",
          "A101": 0.2,
          "SOK": 0.23,
          "BIM": 0.23,
          "MIGROS": 0.26
        }
      },
      "quantity": "2.00",
      "unit": "pcs",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 0.4,
        "SOK": 0.46,
        "BIM": 0.46,
        "MIGROS": 0.52
      }
    },
    {
      "ingredient": {
        "id": 212,
        "created_at": "2025-10-16T21:02:31Z",
        "updated_at": "2025-10-16T21:02:31Z",
        "deleted_on": null,
        "name": "Bell Pepper",
        "category": "vegetables",
        "allergens": [],
        "dietary_info": [
          "vegan",
          "gluten-free"
        ],
        "base_unit": "pcs",
        "base_quantity": "1.00",
        "allowed_units": [
          "pcs"
        ],
        "prices": {
          "currency": "USD",
          "A101": 0.75,
          "SOK": 0.7,
          "BIM": 0.65,
          "MIGROS": 0.8
        }
      },
      "quantity": "4.00",
      "unit": "pcs",
      "costs_for_recipe": {
        "currency": "USD",
        "A101": 3,
        "SOK": 2.8,
        "BIM": 2.6,
        "MIGROS": 3.2
      }
    }
  ],
  "cost_per_serving": "3.06",
  "recipe_costs": {
    "A101": 3.4,
    "SOK": 3.26,
    "BIM": 3.06,
    "MIGROS": 3.72
  },
  "difficulty_rating": null,
  "taste_rating": null,
  "health_rating": null,
  "like_count": 0,
  "comment_count": 0,
  "difficulty_rating_count": 0,
  "taste_rating_count": 0,
  "health_rating_count": 0,
  "is_approved": false,
  "is_featured": false,
  "created_at": "2025-10-18T08:34:48.934143Z",
  "updated_at": "2025-10-18T10:19:40.866151Z",
  "deleted_on": null,
  "total_time": 10,
  "total_user_ratings": 0,
  "total_ratings": 0,
  "allergens": [
    "egg"
  ],
  "dietary_info": [
    "gluten-free",
    "vegan",
    "high-protein"
  ],
  "image": "image/upload/v1760776490/flpxvivt6jyj0xllbpws.png",
  "image_relative_url": "flpxvivt6jyj0xllbpws",
  "image_full_url": "http://res.cloudinary.com/damwfwbjd/image/upload/v1760776490/flpxvivt6jyj0xllbpws.png"
}
```

### 5. **DELETE** `/recipes/{recipe_id}/`
- Deletes a recipe by its ID.
- Requires the user to be authenticated (via Bearer token).
- The recipe is marked as deleted in the database (soft delete).

#### üîç Request Format
- Path variable:
  - "id": 52

- Must be provided:
  - `id`: The ID of the recipe to retrieve.

#### üì¶ Response Format
  - **Success**: Status code 204 No Content (Deleted the recipe and also recipe ingredients)
  - **Failure**: Status code 404 Not Found (Object was not created or already deleted)

## üìç Common Problems:
- **Missing Required Fields**: Ensure all required fields are included in the request body.
- **Invalid Token**: Ensure the Bearer token is valid and not expired. Otherwise you will get a 401 error (Error: Unauthorized).
```json
{
  "detail": "Authentication credentials were not provided."
}
```
  - If you don't know how to get the token, please refer to the `fithub/backend/docs/api_documentations/jwt_token/jwt.md` file.
- **Invalid Ingredient ID**: Ensure the ingredient IDs provided in the request exist in the database. We have only populated the db with some number of ingredients, for now up to 47.
- **Invalid Meal Type**: Ensure the meal type is one of the allowed values (breakfast, lunch, dinner).
- **Invalid Quantity or Unit**: Ensure the quantity is a positive number and the unit is a valid string. We don't have any enum for the unit.

### Quick Reminder:
- It's almost certain that I've made some mistakes or inconsistencies in the above documentation. Please review our swagger documentation and the code itself to ensure everything is accurate and up-to-date. If you find any discrepancies, please correct the documentation accordingly. Thank you for your understanding and cooperation!
- You can easily find the working endpoints and their request/response formats in the swagger documentation. Just run backend locally and go to `http://127.0.0.1:8000/swagger/` to access the swagger UI. You can also use the Postman collection provided in the repository for testing the endpoints but I strongly suggest using the swagger UI for better understanding and testing.